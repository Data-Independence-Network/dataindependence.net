<!DOCTYPE html>
<html class="no-js" lang="en">

<head>

    <!--- basic page needs
    ================================================== -->
    <meta charset="utf-8">
    <title>AIR Blog</title>
    <meta name="description" content="The solution for natural Dao logic">
    <meta name="author" content="Artem V Shamsutdinov">

    <!-- mobile specific metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/vendor.css">
    <link rel="stylesheet" href="../css/main.css">

    <!-- script
    ================================================== -->
    <script src="../js/modernizr.js"></script>

    <!-- favicons
    ================================================== -->
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
    <link rel="manifest" href="../site.webmanifest">

</head>

<body class="ss-bg-white">

    <!-- preloader
================================================== -->
    <div id="preloader">
        <div id="loader" class="dots-fade">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <div id="top" class="s-wrap site-wrapper">

        <!-- site header
    ================================================== -->
        <header class="s-header header">
        </header> <!-- end s-header -->


        <!-- site content
    ================================================== -->
        <div class="s-content content">
            <main class="row content__page">

                <article class="column large-full entry format-standard">

                    <div class="media-wrap entry__media">
                        <div class="entry__post-thumb">
                            <img alt="MIT in collaboration with Commonwealth Fusion Systems created a 20 Tesla magnet"
                                sizes="(max-width: 1000px) 100vw, 1000px" src="images/MIT-superconducting-magnet.jpg">
                            <p style="text-align: center; width: 100%">MIT in collaboration
                                with <a href="https://cfs.energy/">Commonwealth Fusion Systems</a> created a
                                <a
                                    href="https://www.universetoday.com/152521/researchers-create-the-most-powerful-magnet-ever-made-on-earth-20-teslas/">20
                                    Tesla magnet</a>.
                            </p>
                        </div>
                    </div>

                    <div class="content__page-header entry__header">
                        <h1 class="display-1 entry__title">
                            More on APIs
                        </h1>
                        <ul class="entry__header-meta">
                            <li class="author">By Artem V. Shamsutdinov</li>
                            <li class="date">September 28th, 2021</li>
                        </ul>
                    </div> <!-- end entry__header -->

                    <div class="entry__content">
                        I just got the inital implementation of application isolates working
                        (in browser only, without pulling application code from remote location)
                        and as part of that did a pass on API implementations.

                        <h2>Locking down APIs</h2>
                        One thing that hasn't come up yet though is the ability to differentiate
                        between "Application APIs" and "External APIs".  An Application developer
                        should be able to lock down APIs to be either other Application facing
                        or External facing (like web UI, or anything else not running in an App
                        isolate).
                        <br>
                        This can be accomplished by adding more precision to the @Api decorator:
                        <code>
                            <pre>
@Injectable()
<b>export class</b> AnApiClass {

    @Api({ applications: true, external: true})
    <b>async</b> anApi(): any {
        ...
    }        
}
                            </pre>
                        </code>
                        Current thinking is to leave the API wide open by default and allow the
                        developers to lock it down as needed.

                        <h2>AIRport path</h2>
                        One of the tradeoffs that AIRport had to make is to give up some of
                        the elegance when it comes to deleting records but instead not have
                        to maintain a session.
                        <br>
                        I sent quite a bit of time developing with Hibernate (in Java world).
                        It is a great piece of technology but one thing I never liked about
                        it is the fact that entities can be attached and detached from the
                        ORM session.  For INSERTs vs UPDATESs AIRport 
                        <a href="">got around this</a>
                        by maintaing an __originalValues__ property on each object retrieved
                        from the database and diffing it with the passed in values on the
                        "save" operation.  But DELETEs cannot be just as easily maintained.

                        <h2>Ackward DELETEs</h2>
                        The best I can come with for deletes so far is the following:
                        <code>
                            <pre>
/*
 * Marks the object as deleted in 
 */
markAsDeleted(record)

/*
 *
 */
markAsDeleted(record, array) // removes from array, maintains .__deleted__ array property

/*
 *
 */
getNonDeleted(array)

/*
 *
 */
isDeleted(record)
                            </pre>
                        </code>

                        not a common (discouraged even) operation so no big deal

                        

                        <h2>Locking down object state</h2>
                        Thinking about deletes made me realize that one more API lockdown that
                        can be added to @Api - ability to pass in Object State.
                        <br>
                        Object state is what keeps track of if the object has been deleted or
                        not and what the original values of the object were.  It is possible
                        that the application developer wants to maintain all CRUD logic
                        internally to the application (at least on certain APIs).  If that's
                        the case AIRport can accomidate that but scrubbing all object State
                        when an API is called.
                        <code>
                            <pre>
@Injectable()
<b>export class</b> AnApiClass {

    @Api({ objectState: true})
    <b>async</b> anApi(): any {
        ...
    }        
}
                            </pre>
                        </code>
                    </div> <!-- end entry content -->

                </article> <!-- end column large-full entry-->



                 
                <div class="comments-wrap">
                </div> <!-- end comment-respond -->

            </main>

        </div> <!-- end s-content -->


        <!-- footer
    ================================================== -->
        <footer class="s-footer footer">
        </footer>

    </div> <!-- end s-wrap -->


    <!-- Java Script
================================================== -->
    <script src="../js/post-component-loader.js"></script>
    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/plugins.js"></script>
    <script src="../js/main.js"></script>

</body>